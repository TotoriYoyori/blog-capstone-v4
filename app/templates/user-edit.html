{% include 'header.html' %}
<!-- Page Header-->
<header
  class="masthead"
  style="background-image: url('{{ current_user.masthead }}'); padding: 100px"
>
  <div class="container position-relative px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-md-10 col-lg-8 col-xl-10">
        <div class="page-heading">
          <h2>Editing Profile</h2>
          <h1>{{ current_user.name }}</h1>
          <span class="subheading">This is a partial preview of your masthead photo</span>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Main Content-->
<main class="mb-4">
  <div class="container px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-md-10 col-lg-8 col-xl-7">

        <!-- Profile Photo Section -->
        <div class="text-center mb-5">
          <img
            src="{{ current_user.avatar or url_for('static', filename='/assets/img/placeholder.jpg')}}"
            alt="Profile Photo"
            class="profile-photo mb-3"
            style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid #0085A1; box-shadow: 0 4px 8px rgba(0,0,0,0.2);"
          />
        </div>

        <!-- Form Error Messages -->
        {% if name_form.errors %}
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <h5 class="alert-heading mb-3">
              <i class="bi bi-exclamation-triangle-fill"></i> One or more field is invalid:
            </h5>
            {% for field in [name_form.name, name_form.subtitle, name_form.avatar] %}
              {% if field.errors %}
                {% for error in field.errors %}
                  <strong>{{ field.label }}:</strong> {{ error }}
                {% endfor %}
              {% endif %}
            {% endfor %}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endif %}

        {% if password_form.errors %}
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <h5 class="alert-heading mb-3">
              <i class="bi bi-exclamation-triangle-fill"></i> Form can't be left empty when you submit:
            </h5>
            <ul class="mb-0">
              {% for field in [password_form.current_password, password_form.new_password, password_form.confirm_password] %}
                {% if field.errors %}
                  {% for error in field.errors %}
                    <li><strong>{{ field.label.text }}:</strong> {{ error }}</li>
                  {% endfor %}
                {% endif %}
              {% endfor %}
            </ul>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endif %}

        {% include 'flash.html' %}

        <!-- Edit Profile Form -->
        <div class="card shadow-sm">
          <div class="card-body p-4">
            <!-- Name/Email Editing Form -->
            <form method="POST" action="{{ url_for('user.user_edit') }}" novalidate>
              <h5 class="mb-3">Update User Information</h5>
              {{ name_form.csrf_token }}
              <div class="mb-4">
                {{ name_form.name.label(class='form-label fw-bold') }}
                {{ name_form.name(class='form-control form-control-lg', value=current_user.name) }}
              </div>

              <div class="mb-4">
                {{ name_form.email.label(class='form-label fw-bold') }}
                {{ name_form.email(class='greyout form-control form-control-lg', value=current_user.email) }}
                <small class="form-text text-muted">Email cannot be changed</small>
              </div>

              <div class="mb-4">
                {{ name_form.subtitle.label(class='form-label fw-bold') }}
                {{ name_form.subtitle(class='form-control form-control-lg') }}
              </div>

              <div class="mb-4">
                {{ name_form.avatar.label(class='form-label fw-bold') }}
                {{ name_form.avatar(class='form-control form-control-lg') }}
              </div>

              <div class="mb-4">
                {{ name_form.masthead.label(class='form-label fw-bold') }}
                {{ name_form.masthead(class='form-control form-control-lg') }}
              </div>

              <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                {{ name_form.submit(class='btn btn-primary btn-lg') }}
              </div>
            </form>

            <!-- Divider -->
            <hr class="my-4">

            <!-- Password Editing Form -->
            <form method="POST" action="{{ url_for('user.user_edit') }}" novalidate>
              <h4 class="mb-3">Change Password</h4>
              {{ password_form.csrf_token }}
              <div class="mb-3">
                {{ password_form.current_password.label(class='form-label fw-bold') }}
                {{ password_form.current_password(class='form-control') }}
              </div>

              <div class="mb-3">
                {{ password_form.new_password.label(class='form-label fw-bold') }}
                {{ password_form.new_password(class='form-control') }}
                <small class="form-text text-muted">Minimum 12 characters</small>
              </div>

              <div class="mb-4">
                {{ password_form.confirm_password.label(class='form-label fw-bold') }}
                {{ password_form.confirm_password(class='form-control') }}
              </div>

              <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                {{ password_form.submit(class='btn btn-primary btn-lg') }}
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

{% include 'footer.html' %}
